@page "/acceptance/reports/general"
@layout MainLayoutAcceptance

<PageTitlePat Title="SMP (Acceptance) - Report" />

<div class="col-sm-12 m-0 p-0" style="background: url('images/worklist.jpg'); background-size: cover; background-position: center right;">
    <div class="display-4" style="padding: 4rem 2rem;">
        Site Acceptance Report
    </div>
</div>

<BreadcrumbAccess OnAuthenticationCheck="AuthenticationCheck" Paths="@Paths" />

<style type="text/css">
    .miniTable {
        min-height: 150px;
        margin-bottom: 20px;
    }

    #UserTable, #UserTable_header_table {
        /*table-layout: unset !important;*/
    }

    .e-dlg-overlay {
        opacity: .8 !important;
    }
</style>

@if (Requests == null)
{
    <PageLoading />
}
else
{
    <SfGrid ID="ReportTable" DataSource="@Requests" AllowPaging="true" AllowSorting="true" AllowTextWrap="true" AllowFiltering="true" Toolbar="@ToolbarItems" @ref="Grid_Request" ShowColumnChooser="true" AllowExcelExport="true">
        <GridEvents OnToolbarClick="ToolbarClickHandler" TValue="RequestViewModel"></GridEvents>
        <GridFilterSettings Mode="FilterBarMode.Immediate" ImmediateModeDelay="300" Type="Syncfusion.Blazor.Grids.FilterType.Excel"></GridFilterSettings>
        <GridPageSettings PageSize="10"></GridPageSettings>
        <GridSearchSettings></GridSearchSettings>
        <GridTextWrapSettings WrapMode="WrapMode.Content"></GridTextWrapSettings>
        <GridEditSettings AllowAdding="false" AllowEditing="false" AllowDeleting="false" Mode="EditMode.Dialog" ShowDeleteConfirmDialog="true"></GridEditSettings>
        <GridColumns>
            <GridForeignColumn Field="@nameof(RequestViewModel.TechTypeId)" HeaderText="Tech" ForeignKeyField="Id" ForeignKeyValue="Name" ForeignDataSource="@TechTypes" EditType="EditType.DropDownEdit"
                           FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridForeignColumn>
            <GridColumn Field="@nameof(RequestViewModel.UniqueId)" HeaderText="Unique Id" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Field="@nameof(RequestViewModel.BulkBatchNumber)" HeaderText="Batch Number" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Field="@nameof(RequestViewModel.SiteId)" HeaderText="Site Id" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.SiteName)" HeaderText="Site Name" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.RNCBSC)" HeaderText="RNC/BSC" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridForeignColumn Field="@nameof(RequestViewModel.RegionId)" HeaderText="Region" ForeignKeyField="Id" ForeignKeyValue="Name" ForeignDataSource="@Regions" EditType="EditType.DropDownEdit"
                           FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridForeignColumn>
            <GridForeignColumn Visible="false" Field="@nameof(RequestViewModel.SpectrumId)" HeaderText="Spectrum" ForeignKeyField="Id" ForeignKeyValue="Name" ForeignDataSource="@Spectrums" EditType="EditType.DropDownEdit"
                           FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridForeignColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.Bandwidth)" HeaderText="Bandwidth" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.Latitude)" HeaderText="Latitude" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.Longitude)" HeaderText="Longitude" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridForeignColumn Visible="false" Field="@nameof(RequestViewModel.AntennaMakeId)" HeaderText="Antenna Make" ForeignKeyField="Id" ForeignKeyValue="Name" ForeignDataSource="@AntennaMakes" EditType="EditType.DropDownEdit"
                           FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridForeignColumn>
            <GridForeignColumn Visible="false" Field="@nameof(RequestViewModel.AntennaTypeId)" HeaderText="Antenna Type" ForeignKeyField="Id" ForeignKeyValue="Name" ForeignDataSource="@AntennaTypes" EditType="EditType.DropDownEdit"
                           FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridForeignColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.AntennaHeight)" HeaderText="Antenna Height" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.MTilt)" HeaderText="M Tilt" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.ETilt)" HeaderText="E Tilt" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.Baseband)" HeaderText="Baseband"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.RRUType)" HeaderText="RRU Type"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.Power)" HeaderText="Power - (w)" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridForeignColumn Visible="false" Field="@nameof(RequestViewModel.ProjectTypeId)" HeaderText="Project Type" ForeignKeyField="Id" ForeignKeyValue="Name" ForeignDataSource="@ProjectTypes" EditType="EditType.DropDownEdit"
                           FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridForeignColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.ProjectYear)" HeaderText="Project Year" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridForeignColumn Visible="false" Field="@nameof(RequestViewModel.SummerConfigId)" HeaderText="Summer Config" ForeignKeyField="Id" ForeignKeyValue="Name" ForeignDataSource="@SummerConfigs" EditType="EditType.DropDownEdit"
                           FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridForeignColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.SoftwareVersion)" HeaderText="Software Version" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.RRUPower)" HeaderText="RRU Power - (w)" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.CSFBStatusGSM)" HeaderText="CSFB Status GSM" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.CSFBStatusWCDMA)" HeaderText="CSFB Status WCDMA" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.RETConfigured)" HeaderText="RET Configured" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" Field="@nameof(RequestViewModel.CarrierAggregation)" HeaderText="Carrier Aggregation" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
            </GridColumn>
            <GridColumn Visible="false" HeaderText="Engineer" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
                <Template>
                    @{
                    var request = (context as RequestViewModel);
                }

                <span>@(request.EngineerAssigned?.Fullname.Trim())</span>
            </Template>
        </GridColumn>
        @*<GridColumn Field="@nameof(RequestViewModel.MTilt)" HeaderText="M Tilt" TextAlign="TextAlign.Left">
            </GridColumn>*@
        <GridColumn Field="@nameof(RequestViewModel.Status)" HeaderText="Status" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Operator = Operator.Contains })">
        </GridColumn>
        <GridColumn Visible="false" Field="@nameof(RequestViewModel.IntegratedDate)" HeaderText="Date Integrated" TextAlign="TextAlign.Left"
                    Format="d" Type="ColumnType.Date" EditType="EditType.DatePickerEdit" AllowEditing="false"
                    FilterSettings="@(new FilterSettings{ Type = Syncfusion.Blazor.Grids.FilterType.Excel })">
        </GridColumn>
        <GridColumn Visible="false" Field="@nameof(RequestViewModel.DateSubmitted)" HeaderText="Date Submitted" TextAlign="TextAlign.Left"
                    Format="d" Type="ColumnType.Date" EditType="EditType.DatePickerEdit" AllowEditing="false"
                    FilterSettings="@(new FilterSettings{ Type = Syncfusion.Blazor.Grids.FilterType.Excel })">
        </GridColumn>
        <GridColumn Visible="false" Field="@nameof(RequestViewModel.DateActioned)" HeaderText="Date Actioned" TextAlign="TextAlign.Left"
                    Format="d" Type="ColumnType.Date" EditType="EditType.DatePickerEdit" AllowEditing="false"
                    FilterSettings="@(new FilterSettings{ Type = Syncfusion.Blazor.Grids.FilterType.Excel })">
        </GridColumn>
        <GridColumn Visible="false" Field="@nameof(RequestViewModel.EngineerComment)" HeaderText="Engineer Comment" TextAlign="TextAlign.Left"
                    FilterSettings="@(new FilterSettings{ Type = Syncfusion.Blazor.Grids.FilterType.Excel })">
        </GridColumn>
        <GridColumn HeaderText="Bulk" Width="100" AllowFiltering="false">
            <Template>
                @{
                    var request = (context as RequestViewModel);

                    if (request.BulkuploadPath != null)
                    {
                        <a title="Uploaded Bulk" target="_blank" href="Documents/Bulk/@request.BulkuploadPath" class="btn btn-warning"><i class="fas fa-file-download"></i></a>
                    }
                }
            </Template>
        </GridColumn>
        <GridColumn HeaderText="SSV" Width="80" AllowFiltering="false">
            <Template>
                @{
                    var request = (context as RequestViewModel);

                    if (request.SSVReport != null)
                    {
                        var ext = Path.GetExtension(request.SSVReport);
                        var title = ext switch
                        {
                            ".xls" or ".xlsx" or ".ppt" or ".pptx" => "SSV Report",
                            ".eml" or ".msg" => "Waiver Email",
                            _ => ""
                        };

                        var ppts = new List<string> { ".ppt", ".pptx" };

                        var ssvExt = Path.GetExtension(request.SSVReport);
                        var icon = (ppts.Contains(ssvExt)) ? "fa-file-powerpoint" : "fa-file-excel";

                        <a target="_blank" href="Documents/@((request.SSVReportIsWaiver) ? "Waiver" : "SSV")/@request.SSVReport" class="btn btn-warning">
                            <i class="fas fa-fw @((request.SSVReportIsWaiver) ? "fa-envelope": icon)"></i>
                        </a>
                    }
                }
            </Template>
        </GridColumn>
        <GridColumn HeaderText="" Width="80" AllowFiltering="false">
            <Template>
                @{
                    var request = (context as RequestViewModel);

                    <a title="View Details" href="acceptance/report/@request.Id" class="btn btn-warning"><i class="fas fa-eye fa-fw"></i></a>
                }
            </Template>
        </GridColumn>
    </GridColumns>
</SfGrid>

    <div class="my-4"></div>
}